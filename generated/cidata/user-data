#cloud-config
autoinstall:
  version: 1
  identity:
    hostname: myreg.tmp.example.com
    username: user
    password: "$6$kvdA30uoWLv6nq62$l60x57jo6sEX7/8O4xRPzpmzGJFF8xIZXi8PgGY61GDbxU5PRruxpPGz7Zke1D.Sr8okka/uRJaxPuMpLfMYY1"
  locale: en_US
  keyboard:
    layout: us
    toggle: null
    variant: ''
  network:
    network:
      version: 2
      ethernets:
        enp1s0:
          # dhcp4: yes
          addresses: [ 192.168.124.88/24 ]
          gateway4: 192.168.124.1
          nameservers:
            search: [ tmp.example.com ]
            addresses: [ 192.168.124.1 ]
  apt:
    preserve_sources_list: false
    primary:
      - arches: [default]
        uri: http://192.168.122.2/mirror/ubuntu
    sources:
      devel:kubic:libcontainers:stable:
        source: "deb https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/xUbuntu_20.04/ /"
        key: |
          -----BEGIN PGP PUBLIC KEY BLOCK-----
          Version: GnuPG v1.4.5 (GNU/Linux)

          mQENBFtkV0cBCADStSTCG5qgYtzmWfymHZqxxhfwfS6fdHJcbGUeXsI5dxjeCWhs
          XarZm6rWZOd5WfSmpXhbKOyM6Ll+6bpSl5ICHLa6fcpizYWEPa8fpg9EGl0cF12G
          GgVLnnOZ6NIbsoW0LHt2YN0jn8xKVwyPp7KLHB2paZh+KuURERG406GXY/DgCxUx
          Ffgdelym/gfmt3DSq6GAQRRGHyucMvPYm53r+jVcKsf2Bp6E1XAfqBrD5r0maaCU
          Wvd7bi0B2Q0hIX0rfDCBpl4rFqvyaMPgn+Bkl6IW37zCkWIXqf1E5eDm/XzP881s
          +yAvi+JfDwt7AE+Hd2dSf273o3WUdYJGRwyZABEBAAG0OGRldmVsOmt1YmljIE9C
          UyBQcm9qZWN0IDxkZXZlbDprdWJpY0BidWlsZC5vcGVuc3VzZS5vcmc+iQE+BBMB
          CAAoBQJfcJJOAhsDBQkIKusHBgsJCAcDAgYVCAIJCgsEFgIDAQIeAQIXgAAKCRBN
          ZDkDdQYKpB0xCACmtCT6ruPiQa4l0DEptZ+u3NNbZfSVGH4fE4hyTjLbzrCxqcoh
          xJvDKxspuJ85wWFWMtl57+lFFE1KP0AX2XTT+/v2vN1PIfwgOSw3yp2sgWuIXFAi
          89YSjSh8G0SGAH90A9YFMnTbllzGoGURjSX03iasW3A408ljbDehA6rpS3t3FD7P
          PnUF6204orYu00Qvc54an/xVJzxupb69MKW5EeK7x8MJnIToT8hIdOdGVD6axsis
          x+1U71oMK1gBke7p4QPUdhJFpSUd6kT8bcO+7rYouoljFNYkUfwnqtUn7525fkfg
          uDqqXvOJMpJ/sK1ajHOeehp5T4Q45L/qUCb3iEYEExECAAYFAltkV0cACgkQOzAR
          t2udZSOoswCdF44NTN09DwhPFbNYhEMb9juP5ykAn0bcELvuKmgDwEwZMrPQkG8t
          Pu9n
          =42uC
          -----END PGP PUBLIC KEY BLOCK-----

  ssh:
    allow-pw: true
    install-server: true
    authorized-keys: 
      - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDEPmLw/RI0/S7FQh8o+JXFGqh3bTX24tigDyvLg0zCcGDdWgjU7lGq+TlYUbJ3W6SFzxXUXdl1iSssEY2iw1YvwySdQgAXfBd9Hn/k/INcKEErz/A7A2z2EDP9MQHv952lAs/Uik3tA+iFyjt5C1zkeRw0r2w/BRR2vFA7CHZEd9LP/KeX1Q2OUhUIrlnfsgN5us5jB0OtKX4JR3Pf5qaBSnySsojBGbaawrWUr9wqJH2LtkoOvIj8De/jJS6LK8tBH6FV+DY3OueBqdxOtvjFHy5l1PnlWWnIFVi3qhsXIVr46CGntvpSeod6rrQhLfQ/b191/zVqSMFKAL05HTfcr4aIUOw8A4fCigypm4NmfbSq+Mhm9o19k0Dr6Zihh2za54RwZdQOoc1qQYkc19BoPFtuh7wreh4YV6m5Ir7yVt9ApoK+Xj7fYrtkk2y4jBYYm8NP41VLABY6auwTk8X5n8Y8n3RWd/IuiCETSWPivV5es3MleuMBm8AWwQ1X9f0= dops@testdesktop"
  storage:
    # layout:
    #   name: direct
    #   match:
    #     path: /dev/vda
    config:
      - id: disk-vda
        path: /dev/vda
        ptable: gpt
        type: disk
        grub_device: true
      - device: disk-vda
        flag: bios_grub
        id: partition-vda1
        number: 1
        size: 1048576
        type: partition
      - device: disk-vda
        flag: linux
        id: partition-vda2
        number: 2
        size: -1
        type: partition
      - fstype: ext4
        id: format-partition-vda2
        type: format
        volume: partition-vda2
      - id: format-partition-vda2-mount
        device: format-partition-vda2
        type: mount
        path: /
  packages:
    - apache2
    - podman
  user-data:
    timezone: Asia/Kuala_Lumpur
    disable_root: false
    ssh_authorized_keys: 
      - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDEPmLw/RI0/S7FQh8o+JXFGqh3bTX24tigDyvLg0zCcGDdWgjU7lGq+TlYUbJ3W6SFzxXUXdl1iSssEY2iw1YvwySdQgAXfBd9Hn/k/INcKEErz/A7A2z2EDP9MQHv952lAs/Uik3tA+iFyjt5C1zkeRw0r2w/BRR2vFA7CHZEd9LP/KeX1Q2OUhUIrlnfsgN5us5jB0OtKX4JR3Pf5qaBSnySsojBGbaawrWUr9wqJH2LtkoOvIj8De/jJS6LK8tBH6FV+DY3OueBqdxOtvjFHy5l1PnlWWnIFVi3qhsXIVr46CGntvpSeod6rrQhLfQ/b191/zVqSMFKAL05HTfcr4aIUOw8A4fCigypm4NmfbSq+Mhm9o19k0Dr6Zihh2za54RwZdQOoc1qQYkc19BoPFtuh7wreh4YV6m5Ir7yVt9ApoK+Xj7fYrtkk2y4jBYYm8NP41VLABY6auwTk8X5n8Y8n3RWd/IuiCETSWPivV5es3MleuMBm8AWwQ1X9f0= dops@testdesktop"
    package_update: true
    package_upgrade: true
    power_state:
      mode: poweroff
    runcmd:
      - echo testing > /etc/great
  late-commands:
    - "echo 'user ALL=(ALL) NOPASSWD: ALL' > /target/etc/sudoers.d/user"
#    - ". /etc/os-release; echo version is $VERSION_ID gotit > /target/etc/hahaha"
